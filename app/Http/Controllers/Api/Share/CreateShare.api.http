@base=http://localhost:8000
@json=application/json
@token=23|InCcMpzHvpzy7nr0NdfixOaSPxuPNjdSlJdpwm5l292b78e2

### 1) Unauthenticated — expect 401
POST {{base}}/api/shares
Accept: {{json}}
Content-Type: {{json}}

{
  "shareable_type": "file",
  "shareable_id": 57,
  "user_ids": [8],
  "permission": "view"
}

### 2) Validation error — missing fields (expect 422)
POST {{base}}/api/shares
Accept: {{json}}
Authorization: Bearer {{token}}
Content-Type: {{json}}

{}

### 3) Invalid shareable_type — expect 422
POST {{base}}/api/shares
Accept: {{json}}
Authorization: Bearer {{token}}
Content-Type: {{json}}

{
  "shareable_type": "invalid_type",
  "shareable_id": 64,
  "user_ids": [8],
  "permission": "edit"
}

### 4) Non-existing shareable_id — expect 404
POST {{base}}/api/shares
Accept: {{json}}
Authorization: Bearer {{token}}
Content-Type: {{json}}

{
  "shareable_type": "file",
  "shareable_id": 999999,
  "user_ids": [2],
  "permission": "view"
}

### 5) Empty recipients — expect 422
POST {{base}}/api/shares
Accept: {{json}}
Authorization: Bearer {{token}}
Content-Type: {{json}}

{
  "shareable_type": "file",
  "shareable_id": 1,
  "user_ids": [],
  "permission": "view"
}

### 6) Invalid permission — expect 422
POST {{base}}/api/shares
Accept: {{json}}
Authorization: Bearer {{token}}
Content-Type: {{json}}

{
  "shareable_type": "file",
  "shareable_id": 1,
  "user_ids": [2],
  "permission": "invalid"
}

### 7) Successful share — create new share (expect share_created = true, added_user_ids includes recipients)
POST {{base}}/api/shares
Accept: {{json}}
Authorization: Bearer {{token}}
Content-Type: {{json}}

{
  "shareable_type": "file",
  "shareable_id": 58,
  "user_ids": [15, 8],
  "permission": "edit"
}

### 8) Re-share same permission — expect share_created = false, added_user_ids empty for existing recipients, skipped_user_ids list existing ones
POST {{base}}/api/shares
Accept: {{json}}
Authorization: Bearer {{token}}
Content-Type: {{json}}

{
  "shareable_type": "file",
  "shareable_id": 58,
  "user_ids": [15, 8],
  "permission": "edit"
}

### 9) Re-share with changed permission — expect updated_user_ids to include recipients whose permission changed
POST {{base}}/api/shares
Accept: {{json}}
Authorization: Bearer {{token}}
Content-Type: {{json}}

{
  "shareable_type": "file",
  "shareable_id": 58,
  "user_ids": [15, 8],
  "permission": "view"
}

### 10) Add new and existing users — expect added_user_ids and skipped/updated as appropriate
POST {{base}}/api/shares
Accept: {{json}}
Authorization: Bearer {{token}}
Content-Type: {{json}}

{
  "shareable_type": "file",
  "shareable_id": 58,
  "user_ids": [15, 8, 2],
  "permission": "view"
}

