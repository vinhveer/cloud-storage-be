### Storage Usage API tests (comprehensive)

@base=http://localhost:8000
@json=application/json
@token=2|i0D9nOn3QbvUWId0NWyab1TF1lnftJsf8abBO3Ei08d4b12f

#################################################################
# 1) Unauthenticated request -> expect 401
#################################################################

GET {{base}}/api/storage/usage
Accept: {{json}}

#################################################################
# 2) Authenticated request -> stored value present
#    (Set a user's `storage_used` in DB to test this path)
#################################################################

GET {{base}}/api/storage/usage
Accept: {{json}}
Authorization: Bearer {{token}}

# Expected exact JSON shape (example):
# {
#   "success": true,
#   "user_id": 12,
#   "storage_used": 524288000,
#   "formatted": "500 MB"
# }

#################################################################
# 3) Authenticated request -> computed value (users.storage_used is NULL)
#    (Set users.storage_used = NULL and ensure files exist for the user)
#################################################################

GET {{base}}/api/storage/usage
Accept: {{json}}
Authorization: Bearer {{token}}

# Notes:
# - To test computed path: set `users.storage_used` to NULL and insert some files with non-zero file_size
#   where `is_deleted = 0`.
# - To test zero-usage: ensure user has no files and users.storage_used is NULL.
# - The API returns the exact top-level JSON fields requested by the spec.
